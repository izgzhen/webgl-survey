\section{Compiled Information from
three.js}\label{compiled-information-from-three.js}

\subsection{Overview}\label{overview}

\begin{itemize}
\tightlist
\item
  threejs-issue-5421: Buffer deallocation
\item
  threejs-issue-5569: Type mismatch
\item
  threejs-issue-5680: Memory leak
\item
  threejs-issue-5871: Improper sharing
\item
  threejs-issues-83: Name not in scope
\item
  threejs-pull-1602: GLSL
\item
  threejs-issue-4834: Unexpected parameter
\item
  threejs-issue-5098: Buffer not bound
\item
  threejs-issue-5196: Buffer not bound
\item
  threejs-issue-5222: GLSL \& Unexpected parameter
\item
  threejs-issue-5269: Resource deallocation
\item
  threejs-issue-5293: Lack of certain step
\item
  threejs-issue-6952: Missing properties
\item
  threejs-issue-6956: GLSL
\end{itemize}

\subsection{Details}\label{details}

\subsubsection{threejs-pull-1602}\label{threejs-pull-1602}

\paragraph{Categories}\label{categories}

\begin{itemize}
\tightlist
\item
  GLSL
\end{itemize}

\paragraph{Link}\label{link}

\url{https://github.com/mrdoob/three.js/pull/1602}

\paragraph{Remark}\label{remark}

This PR mentioned a problem about adding precision qualifiers to resolve
shader compilation errors on mobile device. This is also a nasty problem
which is platform-dependent \#\#\# threejs-issue-1329 \#\#\#\#
Categories - Typo

\paragraph{Link}\label{link-1}

\url{https://github.com/mrdoob/three.js/issues/1329}

\paragraph{Remark}\label{remark-1}

\texttt{THREE.UnsignedIntType} is written wrongly as
\texttt{THREE.UnsignedShortType}. However, its namespace is
\texttt{THREE}, which is defined by library, not by WebGL. \#\#\#\#
Possible fix I think TAJS might be able to resolve this by analyzing
information of object property? \#\#\# threejs-issue-4834 \#\#\#\#
Categories - unexpected parameter

\paragraph{Link}\label{link-2}

\url{https://github.com/mrdoob/three.js/issues/4834}

\paragraph{Remark}\label{remark-2}

Discussed 2 problems here related to the compilation failure of the
shader.

\begin{itemize}
\item
  \href{https://github.com/Nimanf/three.js/commit/7f7650c5e012890a34c26c1c6fa2f8482d855627}{This
  commit} used \texttt{max()} to limit negative values for
  \texttt{pow()} in shaders.
\item
  Then there is a discussion about the warning X3557 caused by
  \texttt{MAX\_DIR\_LIGHTS} is 1 and the redundant loop:
\end{itemize}

\begin{verbatim}
#define MAX_DIR_LIGHTS 1
#if MAX_DIR_LIGHTS > 0
for( int i = 0; i < MAX_DIR_LIGHTS; i++ ) { ...
\end{verbatim}

\paragraph{Possible fix}\label{possible-fix}

maybe same as
\href{https://git.ustclug.org/VeriGL/VeriGL-Dark-Side/wikis/threejs-issue-5222}{threejs
issue 5222} \#\#\# threejs-issue-5098 \#\#\#\# Categories - Buffer not
bound

\paragraph{Link}\label{link-3}

\url{https://github.com/mrdoob/three.js/issues/5098}

\paragraph{Remark}\label{remark-3}

An eye catched error.

\begin{quote}
\texttt{THREE.Float32Attribute} has been removed.
\end{quote}

Use THREE.BufferAttribute( array, itemSize ) instead.

this
\href{https://github.com/mrdoob/three.js/commit/e5b1d38e1e90bc9f7b16da7c1e53e66c5e8c2178}{commit}
solves this:

\begin{verbatim}
- geometry.addAttribute( 'position', new THREE.Float32Attribute( numEdges * 2 * 3, 3 ) );
+ geometry.addAttribute( 'position', new THREE.BufferAttribute( new Float32Array( numEdges * 2 * 3 ), 3 ) );
\end{verbatim}

\paragraph{Possible fix}\label{possible-fix-1}

Search for available functions in the lib \#\#\# threejs-issue-5196
\#\#\#\# Categories - Buffer not bound

\paragraph{Link}\label{link-4}

\url{https://github.com/mrdoob/three.js/issues/5196\#issue-40214568}

\paragraph{Remark}\label{remark-4}

Found while playing with threejs.org/editor

After adding a Mesh with the Menubar's `Add' panel, sidebar geometry
parameter changes cause the object to stop displaying.

Console warnings from WebGL:
\texttt{WebGL:\ INVALID\_OPERATION:\ vertexAttribPointer:\ no\ bound\ ARRAY\_BUFFER\ three.min.js:545\ WebGL:\ INVALID\_OPERATION:\ vertexAttribPointer:\ no\ bound\ ARRAY\_BUFFER\ three.min.js:549\ WebGL:\ INVALID\_OPERATION:\ drawElements:\ no\ ELEMENT\_ARRAY\_BUFFER\ bound\ three.min.js:552\ {[}17:54:37{]}\ Saved\ state\ to\ IndexedDB.\ 0.71ms\ Storage.js:64}
\#\#\#\# Possible fix Track the \texttt{gl} context and the
\texttt{buffer} might avoid these. \#\#\# threejs-issue-5222 \#\#\#\#
Categories - GLSL - unexpected parameter

\paragraph{Link}\label{link-5}

\url{https://github.com/mrdoob/three.js/issues/5222}

\paragraph{Remark}\label{remark-5}

As referred to to
\href{https://www.khronos.org/registry/gles/specs/2.0/GLSL_ES_Specification_1.0.17.pdf}{GLSL
mannual} P65, in \texttt{genType\ pow\ (genType\ x,\ genType\ y)},
results are undefined if x = 0 and y \textless{}= 0. So in the generated
GLSL in the issue, \texttt{pow(pointDotNormalHalf,\ shininess)} could be
undefined and not warned. In the commit
\href{https://github.com/mrdoob/three.js/commit/a13cf4343effc741b0aa333c37062cc7cc3d71c7}{\#7252},
this was fixed by:
\texttt{-\ \ \ \ uniforms.shininess.value\ =\ material.shininess;}
\texttt{+\ \ \ \ uniforms.shininess.value\ =\ Math.max(\ material.shininess,\ 1e-4\ );}
\#\#\#\# Possible fix Interval analysis and warning \#\#\#\# Related -
\href{https://github.com/mrdoob/three.js/issues/7252}{messed up OBJMTL
loader \#7252} -
\href{https://github.com/mrdoob/three.js/issues/6057}{MeshPhongMaterial
with shininess = 0 causes artifacts on Windows \#6057}

\subsubsection{threejs-issue-5269}\label{threejs-issue-5269}

\paragraph{Categories}\label{categories-1}

\begin{itemize}
\tightlist
\item
  Resource deallocation
\end{itemize}

\paragraph{Link}\label{link-6}

\url{https://github.com/mrdoob/three.js/issues/5269}

\paragraph{Remark}\label{remark-6}

The child of object3D was not removed before removing the object3D
itself. This arouse the memory leakage. \#\#\#\# Possible fix Might be
fixed by tracking the state of the object? \#\#\# threejs-issue-5293
\#\#\#\# Categories - Lack of certain step

\paragraph{Link}\label{link-7}

\url{https://github.com/mrdoob/three.js/issues/5293}

\paragraph{Remark}\label{remark-7}

\texttt{WebGLRenderer} is not doing \texttt{updateObject(\ object\ )}
because is not visible from the main camera. hen an error
\texttt{glDrawElements:\ range\ out\ of\ bounds\ for\ buffer} would
occur. \#\#\#\# Possible fix Might be fixed by tracking the state of the
object? \#\#\#\# Related - The author broke it again recently in
\href{https://github.com/mrdoob/three.js/issues/6996}{\#6996}

\subsubsection{threejs-issue-5421}\label{threejs-issue-5421}

\paragraph{Categories}\label{categories-2}

\begin{itemize}
\tightlist
\item
  Buffer deallocation
\end{itemize}

\paragraph{Link}\label{link-8}

\url{https://github.com/mrdoob/three.js/issues/5421}

\paragraph{Remark}\label{remark-8}

According to the
\href{https://github.com/mrdoob/three.js/commit/70ca93c2fe184795e5410a6b30e625dee43af870}{commit},
the problem is that we should not only call
\texttt{\_gl.deleteBuffer(buffer\_obj)}, but also call
\texttt{delete\ buffer\_obj\ {[}Document\ about}deleteBuffer`{]}(https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/deleteBuffer).
\#\#\#\# Possible fix The problem might cause the old state to persist
unexpectedly. So one way of elimination is to require a ``fresh'' state
explicitly at some point, which can preclude such presence if possible.
\#\#\# threejs-issue-5569 \#\#\#\# Categories - Type error

\paragraph{Link}\label{link-9}

\url{https://github.com/mrdoob/three.js/commit/1311c0e315326bdb9c02a5c7b8733bb0c27fb1ea}

\paragraph{Remark}\label{remark-9}

\href{https://github.com/mrdoob/three.js/commit/1311c0e315326bdb9c02a5c7b8733bb0c27fb1ea}{Commit}.
Well, it is recognised by naked eyes. But first it is a silent bug,
which is rather harmful. Second, although threejs doesn't depend on
\texttt{gl-matrix.js}, it has a similar internal system \#\#\#\#
Possible fix Add additional type information \#\#\# threejs-issue-5680
\#\#\#\# Categories - Memory leak

\paragraph{Link}\label{link-10}

\url{https://github.com/mrdoob/three.js/issues/5680}

\paragraph{Remark}\label{remark-10}

Fixed in \href{https://github.com/mrdoob/three.js/pull/5723}{PR}, with
\href{https://github.com/AVGP/three.js/commit/2518eaac07154bd466c4a7d18b819cc47f5ee0aa}{commit}.
This is very nasty \ldots{} I can't give a reasonable fix now. \#\#\#
threejs-issue-5871 \#\#\#\# Categories - Improper sharing

\paragraph{Link}\label{link-11}

\url{https://github.com/mrdoob/three.js/issues/5871}

\paragraph{Remark}\label{remark-11}

This is caused by the geometry being shared across contexts outside of
the closure in \texttt{ArrowHelper}'s definition.
\href{https://github.com/mrdoob/three.js/pull/6723}{A length related
discussion}. \#\#\#\# Possible fix Globally, we might be able to couple
a context with a buffer. \#\#\# threejs-issue-6952 \#\#\#\# Categories -
missing properties

\paragraph{Link}\label{link-12}

\url{https://github.com/mrdoob/three.js/pull/6952}

\paragraph{Remark}\label{remark-12}

When exporting \texttt{BoxGeometry} parameters(width, height, depth) by
\texttt{SceneExporter}, it should be \texttt{g.parameters.width} rather
than \texttt{g.width}. Fixed by this
\href{https://github.com/dubejf/three.js/commit/b5b79a7a6aa4b42846f89e4852f36719543a3438}{commit}.
\#\#\#\# Possible fix Track object's properties. \#\#\#\# Related -
SceneExporter doesn't handle box/sphere/plane parameters \#4739 -
SceneExporter // BoxGeometry Inconsistent \#5067 - \#5067 make
SceneExporter use correct BoxGeometry parameters \#5068

\subsubsection{threejs-issue-6956}\label{threejs-issue-6956}

\paragraph{Categories}\label{categories-3}

\begin{itemize}
\tightlist
\item
  GLSL
\end{itemize}

\paragraph{Link}\label{link-13}

\url{https://github.com/mrdoob/three.js/issues/6956}

\paragraph{Remark}\label{remark-13}

Pull: https://github.com/thothbot/parallax/pull/43 In GLSL, extension
directive must occur before any non-preprocessor tokens, otherwise a
warning is raised. Threejs fixed in 72dev. \#\#\#\# Related -
\href{https://github.com/thothbot/parallax/pull/43}{parallax} -
\href{https://github.com/typpo/ancient-earth/commit/91f9d75ab45db8e7ba3d2e156e313f079f6826ed}{ancient-earth}

\subsubsection{threejs-issues-83}\label{threejs-issues-83}

\paragraph{Categories}\label{categories-4}

\begin{itemize}
\tightlist
\item
  Name not in scope
\end{itemize}

\paragraph{Link}\label{link-14}

\url{https://github.com/mrdoob/three.js/issues/83}

\paragraph{Remark}\label{remark-14}

The \texttt{scene} referenced isn't passed in as an argument or declared
above - so it's looking in the global scope. So it tends to be some
programming style issue, which is related to the problem being solved.

\subsubsection{threejs-pull-1602}\label{threejs-pull-1602-1}

\paragraph{Categories}\label{categories-5}

\begin{itemize}
\tightlist
\item
  GLSL
\end{itemize}

\paragraph{Link}\label{link-15}

\url{https://github.com/mrdoob/three.js/pull/1602}

\paragraph{Remark}\label{remark-15}

This PR mentioned a problem about adding precision qualifiers to resolve
shader compilation errors on mobile device. This is also a nasty problem
which is platform-dependent
